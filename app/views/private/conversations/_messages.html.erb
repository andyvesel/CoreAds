<% previous_message = nil %>
<% @messages.reverse.each do |message| %>
  <%= render  partial: 'messages/_message', 
              locals: { user: message.user, 
                        conversation_id: @conversation.id,
                        message: message, 
                        previous_message: previous_message } %>
  <% previous_message = message %>
<% end %>